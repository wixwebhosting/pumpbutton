<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ THE PUMP BUTTON üöÄ</title>
    <link rel="icon" type="image/png" href="pump.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial Black', Arial, sans-serif;
            background: linear-gradient(45deg, #1a1a2e, #16213e, #0f3460);
            background-size: 400% 400%;
            color: #fff;
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #ff0000, #cc0000, #990000);
            background-size: 400% 400%;
            opacity: 0;
            transition: opacity 3s ease-in, opacity 5s ease-out;
            pointer-events: none;
            z-index: -1;
            animation: gradientShift 15s ease infinite;
        }

        body.overheating::before {
            opacity: 1;
            animation: gradientShift 15s ease infinite, heatPulse 0.5s ease infinite;
        }

        @keyframes heatPulse {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .x-logo-link {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            transition: transform 0.3s ease;
        }

        .x-logo-link:hover {
            transform: scale(1.1);
        }

        .x-logo {
            width: 40px;
            height: 40px;
            fill: #fff;
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.5));
            transition: filter 0.3s ease;
        }

        .x-logo-link:hover .x-logo {
            filter: drop-shadow(0 0 20px rgba(0, 255, 136, 0.8));
        }

        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px 0;
        }

        h1 {
            font-size: 3.5em;
            text-shadow: 0 0 20px #00ff88, 0 0 40px #00ff88;
            margin-bottom: 10px;
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { text-shadow: 0 0 20px #00ff88, 0 0 40px #00ff88; }
            to { text-shadow: 0 0 30px #00ff88, 0 0 60px #00ff88, 0 0 80px #00ff88; }
        }

        .subtitle {
            font-size: 1.2em;
            color: #aaa;
            margin-bottom: 20px;
        }

        .stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }

        .stat-box {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px 40px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(0, 255, 136, 0.3);
        }

        .stat-label {
            font-size: 0.9em;
            color: #aaa;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 2.5em;
            color: #00ff88;
            font-weight: bold;
        }

        .pump-section {
            text-align: center;
            margin: 60px 0;
        }

        .pump-button {
            width: 400px;
            height: 400px;
            border-radius: 50%;
            background: linear-gradient(145deg, #ff0080, #ff6b00);
            border: 8px solid #fff;
            box-shadow: 0 20px 60px rgba(255, 0, 128, 0.6), 0 0 0 0 rgba(255, 0, 128, 0.7);
            cursor: pointer;
            font-size: 3em;
            font-weight: bold;
            color: #fff;
            transition: all 0.1s;
            position: relative;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
        }

        .pump-button:hover {
            transform: scale(1.05);
            box-shadow: 0 25px 80px rgba(255, 0, 128, 0.8), 0 0 0 0 rgba(255, 0, 128, 0.7);
        }

        .pump-button:active {
            transform: scale(0.95);
            box-shadow: 0 10px 40px rgba(255, 0, 128, 0.6);
        }

        .pump-button.pumping {
            animation: pumpPulse 0.5s ease-out;
        }

        @keyframes pumpPulse {
            0%, 100% { transform: scale(1); }
            25% { transform: scale(1.15) rotate(5deg); }
            75% { transform: scale(1.15) rotate(-5deg); }
        }

        .flash-text {
            font-size: 3em;
            font-weight: bold;
            text-align: center;
            margin: 30px 0;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transform: scale(0.5);
            transition: all 0.3s;
        }

        .flash-text.show {
            animation: flashIn 0.8s ease-out;
        }

        @keyframes flashIn {
            0% {
                opacity: 0;
                transform: scale(0.5);
            }
            20% {
                opacity: 1;
                transform: scale(1.2);
            }
            80% {
                opacity: 1;
                transform: scale(1.1);
            }
            100% {
                opacity: 0;
                transform: scale(1);
            }
        }

        .leaderboard {
            background: rgba(255, 255, 255, 0.05);
            padding: 30px;
            border-radius: 20px;
            margin-top: 60px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(0, 255, 136, 0.2);
        }

        .leaderboard h2 {
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 30px;
            color: #00ff88;
        }

        .leaderboard-list {
            list-style: none;
            max-width: 600px;
            margin: 0 auto;
        }

        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            padding: 15px 25px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            align-items: center;
            transition: all 0.3s;
        }

        .leaderboard-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(10px);
        }

        .leaderboard-rank {
            font-size: 1.5em;
            font-weight: bold;
            color: #ffd700;
            min-width: 50px;
        }

        .leaderboard-name {
            flex: 1;
            font-size: 1.2em;
        }

        .leaderboard-pumps {
            font-size: 1.3em;
            color: #00ff88;
            font-weight: bold;
        }

        .username-input {
            text-align: center;
            margin-bottom: 20px;
        }

        .username-input input {
            padding: 12px 20px;
            font-size: 1.1em;
            border-radius: 10px;
            border: 2px solid rgba(0, 255, 136, 0.5);
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            outline: none;
            width: 300px;
            text-align: center;
        }

        .username-input input::placeholder {
            color: #aaa;
        }

        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }

        .particle {
            position: absolute;
            font-size: 2em;
            animation: float 2s ease-out forwards;
            pointer-events: none;
        }

        @keyframes float {
            0% {
                opacity: 1;
                transform: translateY(0) rotate(0deg);
            }
            100% {
                opacity: 0;
                transform: translateY(-300px) rotate(360deg);
            }
        }

        .username-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(10px);
            opacity: 1;
            transition: opacity 0.3s ease;
        }

        .username-modal.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .container {
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .container.visible {
            opacity: 1;
        }

        .modal-content {
            background: linear-gradient(145deg, #1a1a2e, #16213e);
            padding: 50px 60px;
            border-radius: 25px;
            text-align: center;
            border: 3px solid #00ff88;
            box-shadow: 0 0 50px rgba(0, 255, 136, 0.5);
            animation: modalPop 0.3s ease-out;
        }

        @keyframes modalPop {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .modal-content h2 {
            font-size: 2.5em;
            margin-bottom: 20px;
            color: #00ff88;
            text-shadow: 0 0 20px #00ff88;
        }

        .modal-content p {
            font-size: 1.1em;
            color: #aaa;
            margin-bottom: 30px;
        }

        .modal-content input {
            padding: 15px 25px;
            font-size: 1.3em;
            border-radius: 15px;
            border: 3px solid #00ff88;
            background: rgba(0, 0, 0, 0.5);
            color: #fff;
            outline: none;
            width: 100%;
            max-width: 350px;
            text-align: center;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .modal-content input::placeholder {
            color: #666;
        }

        .modal-content .char-count {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 20px;
        }

        .modal-content .char-count.error {
            color: #ff4444;
        }

        .modal-content .char-count.blocked {
            color: #ff0000;
            font-size: 1.5em;
            font-weight: bold;
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .modal-content button {
            padding: 15px 40px;
            font-size: 1.2em;
            font-weight: bold;
            border-radius: 15px;
            border: none;
            background: linear-gradient(145deg, #00ff88, #00cc6a);
            color: #000;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
        }

        .modal-content button:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.6);
        }

        .modal-content button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        @media (max-width: 768px) {
            h1 { font-size: 2em; }
            .pump-button { width: 250px; height: 250px; font-size: 2em; }
            .flash-text { font-size: 1.5em; }
            .stats { gap: 20px; }
            .modal-content { padding: 30px 40px; }
            .modal-content h2 { font-size: 1.8em; }
        }
    </style>
</head>
<body>
    <!-- X Logo Link -->
    <a href="https://x.com/thepumpbutton" target="_blank" rel="noopener noreferrer" class="x-logo-link">
        <svg class="x-logo" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
        </svg>
    </a>

    <!-- Username Modal -->
    <div class="username-modal" id="usernameModal">
        <div class="modal-content">
            <h2>üöÄ JOIN THE PUMP! üöÄ</h2>
            <p>Enter your username to start pumping</p>
            <input 
                type="text" 
                id="modalUsernameInput" 
                placeholder="Enter username"
                maxlength="12"
                autocomplete="off"
            >
            <div class="char-count" id="charCount">3-12 characters required</div>
            <button id="startPumpingBtn" disabled>START PUMPING</button>
        </div>
    </div>

    <div class="particles" id="particles"></div>
    
    <div class="container main-container" id="mainContainer">
        <header>
            <h1>üöÄ THE PUMP BUTTON üöÄ</h1>
            <p class="subtitle">The most important button on in the trenches</p>
        </header>

        <div class="stats">
            <div class="stat-box">
                <div class="stat-label">GLOBAL PUMPS</div>
                <div class="stat-value" id="globalCounter">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">YOUR PUMPS</div>
                <div class="stat-value" id="userCounter">0</div>
            </div>
        </div>

        <div class="username-input">
            <input type="text" id="usernameInput" placeholder="Pumping as:" maxlength="12" readonly>
        </div>

        <div class="pump-section">
            <button class="pump-button" id="pumpButton">
                PUMP IT!
            </button>
        </div>

        <div class="flash-text" id="flashText"></div>

        <div class="leaderboard">
            <h2>üèÜ TOP PUMPERS üèÜ</h2>
            <ul class="leaderboard-list" id="leaderboardList">
                <li class="leaderboard-item">
                    <span class="leaderboard-rank">1.</span>
                    <span class="leaderboard-name">Loading...</span>
                    <span class="leaderboard-pumps">0 pumps</span>
                </li>
            </ul>
        </div>
    </div>

    <script>
        // Dynamic WebSocket URL for Railway deployment
        const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
        const wsUrl = `${protocol}//${window.location.host}`;
        const ws = new WebSocket(wsUrl);
        const pumpButton = document.getElementById('pumpButton');
        const flashText = document.getElementById('flashText');
        const globalCounter = document.getElementById('globalCounter');
        const userCounter = document.getElementById('userCounter');
        const usernameInput = document.getElementById('usernameInput');
        const leaderboardList = document.getElementById('leaderboardList');
        const particles = document.getElementById('particles');
        const usernameModal = document.getElementById('usernameModal');
        const modalUsernameInput = document.getElementById('modalUsernameInput');
        const startPumpingBtn = document.getElementById('startPumpingBtn');
        const charCount = document.getElementById('charCount');

        let audioContext;
        let username = localStorage.getItem('pumpUsername') || '';
        let userPumps = parseInt(localStorage.getItem('userPumps') || '0');
        
        // Click rate tracking for overheat effect
        let clickTimes = [];
        let isOverheating = false;
        let overheatCheckInterval;
        let flashTextTimeout = null;

        // Memecoin phrases
        const pumpPhrases = [
            'üí∞ PUMPING HOPIUM INTO THE MARKETS üí∞',
            'üöÄ TO THE MOON! WAGMI! üöÄ',
            'üíé DIAMOND HANDS ACTIVATED üíé',
            'üìà BUY THE DIP! HODL! üìà',
            'üî• LFG! BULLISH AF! üî•',
            '‚≠ê NOT FINANCIAL ADVICE ‚≠ê',
            'üí∏ NGMI IF YOU DON\'T PUMP üí∏',
            'üåô WEN LAMBO? NOW! üåô',
            'ü¶ç APES TOGETHER STRONG ü¶ç',
            '‚ö° PUMP IT LOUDER! ‚ö°'
        ];

        const mainContainer = document.getElementById('mainContainer');
        
        // Show modal immediately if no username
        if (!username || username.length < 3) {
            usernameModal.classList.remove('hidden');
            mainContainer.classList.remove('visible');
            setTimeout(() => modalUsernameInput.focus(), 100);
        } else {
            usernameModal.classList.add('hidden');
            mainContainer.classList.add('visible');
            usernameInput.value = username;
            // Start overheat monitoring for returning users
            startOverheatMonitoring();
        }

        // Profanity filter
        const blockedWords = ['nigger', 'nigga', 'n1gger', 'n1gg3r', 'nig'];
        
        function containsBlockedWord(text) {
            const lower = text.toLowerCase().replace(/[^a-z0-9]/g, '');
            return blockedWords.some(word => lower.includes(word));
        }

        // Username modal validation
        modalUsernameInput.addEventListener('input', (e) => {
            const value = e.target.value.trim();
            const length = value.length;
            
            charCount.classList.remove('error', 'blocked');
            
            if (containsBlockedWord(value)) {
                charCount.textContent = 'DO YOU THINK YOU\'RE FUCKING FUNNY BUDDY?';
                charCount.classList.add('blocked');
                startPumpingBtn.disabled = true;
                modalUsernameInput.value = '';
                return;
            }
            
            if (length === 0) {
                charCount.textContent = '3-12 characters required';
                startPumpingBtn.disabled = true;
            } else if (length < 3) {
                charCount.textContent = `${length}/12 - Need ${3 - length} more`;
                charCount.classList.add('error');
                startPumpingBtn.disabled = true;
            } else {
                charCount.textContent = `${length}/12 - Perfect!`;
                startPumpingBtn.disabled = false;
            }
        });

        modalUsernameInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !startPumpingBtn.disabled) {
                startPumping();
            }
        });

        startPumpingBtn.addEventListener('click', startPumping);

        function startPumping() {
            const value = modalUsernameInput.value.trim();
            
            if (containsBlockedWord(value)) {
                charCount.textContent = 'DO YOU THINK YOU\'RE FUCKING FUNNY BUDDY?';
                charCount.classList.add('blocked');
                modalUsernameInput.value = '';
                return;
            }
            
            if (value.length >= 3 && value.length <= 12) {
                username = value;
                localStorage.setItem('pumpUsername', username);
                usernameInput.value = username;
                usernameModal.classList.add('hidden');
                mainContainer.classList.add('visible');
                
                // Start overheat monitoring
                startOverheatMonitoring();
            }
        }

        // Initialize audio context on first user interaction
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        // Create pump sound effect
        function playPumpSound() {
            initAudio();
            
            const now = audioContext.currentTime;
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(200, now);
            oscillator.frequency.exponentialRampToValueAtTime(600, now + 0.1);
            oscillator.frequency.exponentialRampToValueAtTime(100, now + 0.2);
            
            gainNode.gain.setValueAtTime(0.3, now);
            gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
            
            oscillator.start(now);
            oscillator.stop(now + 0.3);
        }

        // Create overheat sound effect - momentum based with continuous frequency control
        let overheatOscillator = null;
        let overheatGain = null;
        let targetFrequency = 40;
        let currentFrequency = 40;
        let targetVolume = 0;
        let currentVolume = 0;
        let frequencyUpdateInterval = null;
        
        function updateFrequency() {
            if (!overheatOscillator || !audioContext) return;
            
            const now = audioContext.currentTime;
            
            // Smoothly interpolate current frequency towards target (slower interpolation)
            const freqDiff = targetFrequency - currentFrequency;
            currentFrequency += freqDiff * 0.05; // 5% per update for smoother transition
            
            // Smoothly interpolate volume
            const volDiff = targetVolume - currentVolume;
            currentVolume += volDiff * 0.08; // 8% per update
            
            overheatOscillator.frequency.setValueAtTime(Math.max(40, currentFrequency), now);
            overheatGain.gain.setValueAtTime(Math.max(0, currentVolume), now);
        }
        
        function ensureOverheatSound() {
            initAudio();
            
            if (!overheatOscillator) {
                // Start the oscillator
                const now = audioContext.currentTime;
                overheatOscillator = audioContext.createOscillator();
                overheatGain = audioContext.createGain();
                
                overheatOscillator.connect(overheatGain);
                overheatGain.connect(audioContext.destination);
                
                overheatOscillator.type = 'sawtooth';
                currentFrequency = 40;
                currentVolume = 0;
                overheatOscillator.frequency.setValueAtTime(40, now);
                overheatGain.gain.setValueAtTime(0, now);
                
                overheatOscillator.start(now);
                
                // Start frequency update loop
                if (!frequencyUpdateInterval) {
                    frequencyUpdateInterval = setInterval(updateFrequency, 50);
                }
            }
        }
        
        function setOverheatTarget(heating) {
            if (heating) {
                targetFrequency = 220; // Heat up (lower max)
                targetVolume = 0.12; // Fade in volume (lower max)
            } else {
                targetFrequency = 40; // Cool down to lower
                targetVolume = 0.02; // Fade out volume but keep audible
            }
        }
        
        function stopOverheatSoundCompletely() {
            if (!overheatOscillator) return;
            
            // Set target to zero
            targetVolume = 0;
            targetFrequency = 40;
            
            setTimeout(() => {
                if (overheatOscillator && currentVolume < 0.01) {
                    try {
                        overheatOscillator.stop();
                    } catch (e) {}
                    overheatOscillator = null;
                    overheatGain = null;
                }
                if (frequencyUpdateInterval) {
                    clearInterval(frequencyUpdateInterval);
                    frequencyUpdateInterval = null;
                }
                currentFrequency = 40;
                targetFrequency = 40;
                currentVolume = 0;
                targetVolume = 0;
            }, 3000);
        }

        // Overheat monitoring
        function startOverheatMonitoring() {
            if (overheatCheckInterval) {
                console.log('Overheat monitoring already running');
                return;
            }
            
            console.log('Started overheat monitoring');
            
            overheatCheckInterval = setInterval(() => {
                const now = Date.now();
                // Remove clicks older than 1 second
                clickTimes = clickTimes.filter(time => now - time < 1000);
                
                // If more than 5 clicks in last 1 second, overheat
                if (clickTimes.length > 5) {
                    if (!isOverheating) {
                        isOverheating = true;
                        document.body.classList.add('overheating');
                        console.log('üî• OVERHEATING! Clicks:', clickTimes.length);
                    }
                    // Ensure sound is playing and set to heat up
                    ensureOverheatSound();
                    setOverheatTarget(true);
                } else {
                    if (isOverheating) {
                        isOverheating = false;
                        document.body.classList.remove('overheating');
                        console.log('‚ùÑÔ∏è Cooling down...');
                    }
                    // Set to cool down (but keep playing for a bit)
                    if (overheatOscillator) {
                        setOverheatTarget(false);
                        
                        // Only stop completely after it's been cool for a while
                        setTimeout(() => {
                            if (!isOverheating && currentFrequency < 70 && currentVolume < 0.08) {
                                stopOverheatSoundCompletely();
                            }
                        }, 2000);
                    }
                }
            }, 100);
        }

        function createParticles(x, y) {
            const emojis = ['üöÄ', 'üíé', 'üí∞', 'üìà', 'üåô', '‚≠ê', 'üí∏', 'üî•'];
            for (let i = 0; i < 12; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';
                particle.style.transform = `rotate(${Math.random() * 360}deg)`;
                
                const angle = (Math.PI * 2 * i) / 12;
                const tx = Math.cos(angle) * (100 + Math.random() * 50);
                const ty = Math.sin(angle) * (100 + Math.random() * 50);
                particle.style.setProperty('--tx', tx + 'px');
                particle.style.setProperty('--ty', ty + 'px');
                
                particles.appendChild(particle);
                
                setTimeout(() => particle.remove(), 2000);
            }
        }

        pumpButton.addEventListener('click', (e) => {
            // Track click time for overheat detection
            const now = Date.now();
            clickTimes.push(now);
            console.log('Click tracked. Total clicks in window:', clickTimes.filter(t => now - t < 1000).length);
            
            // Play sound
            playPumpSound();
            
            // Add pumping animation
            pumpButton.classList.add('pumping');
            setTimeout(() => pumpButton.classList.remove('pumping'), 500);
            
            // Show random flash text
            const randomPhrase = pumpPhrases[Math.floor(Math.random() * pumpPhrases.length)];
            flashText.textContent = randomPhrase;
            
            // Clear any existing timeout to prevent early removal
            if (flashTextTimeout) {
                clearTimeout(flashTextTimeout);
            }
            
            flashText.classList.remove('show');
            // Force reflow to restart animation
            void flashText.offsetWidth;
            flashText.classList.add('show');
            
            flashTextTimeout = setTimeout(() => {
                flashText.classList.remove('show');
                flashTextTimeout = null;
            }, 3000);
            
            // Create particles
            const rect = pumpButton.getBoundingClientRect();
            createParticles(rect.left + rect.width / 2, rect.top + rect.height / 2);
            
            // Update local counter
            userPumps++;
            userCounter.textContent = userPumps.toLocaleString();
            localStorage.setItem('userPumps', userPumps);
            
            // Send to server
            if (ws && ws.readyState === WebSocket.OPEN) {
                const pumpData = {
                    type: 'pump',
                    username: username || 'Anonymous'
                };
                console.log('üöÄ Sending pump data:', pumpData);
                ws.send(JSON.stringify(pumpData));
            } else {
                console.error('‚ùå WebSocket not connected - pump data will be lost. ReadyState:', ws ? ws.readyState : 'No WebSocket');
            }
        });

        let reconnectAttempts = 0;
        const maxReconnectAttempts = 5;

        function connectWebSocket() {
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsUrl = `${protocol}//${window.location.host}`;
            console.log('Attempting to connect to WebSocket:', wsUrl);
            ws = new WebSocket(wsUrl);

            ws.addEventListener('open', () => {
                console.log('‚úÖ Connected to pump server!');
                reconnectAttempts = 0; // Reset reconnection attempts on successful connection
            });

            ws.addEventListener('message', (event) => {
                try {
                    const data = JSON.parse(event.data);
                    console.log('üì® Received WebSocket message:', data);

                    if (data.type === 'update') {
                        if (data.totalPumps !== undefined) {
                            console.log('üî¢ Updating global counter to:', data.totalPumps);
                            globalCounter.textContent = data.totalPumps.toLocaleString();
                        }
                        if (data.leaderboard) {
                            console.log('üèÜ Updating leaderboard:', data.leaderboard);
                            updateLeaderboard(data.leaderboard);
                        }
                    }
                } catch (error) {
                    console.error('‚ùå Error parsing WebSocket message:', error, 'Raw data:', event.data);
                }
            });

            ws.addEventListener('close', (event) => {
                console.log('üîå WebSocket disconnected. Code:', event.code, 'Reason:', event.reason);
                if (reconnectAttempts < maxReconnectAttempts) {
                    reconnectAttempts++;
                    console.log(`üîÑ Attempting to reconnect (${reconnectAttempts}/${maxReconnectAttempts})...`);
                    setTimeout(connectWebSocket, 2000 * reconnectAttempts); // Exponential backoff
                } else {
                    console.log('‚ùå Max reconnection attempts reached. Please refresh the page.');
                }
            });

            ws.addEventListener('error', (error) => {
                console.error('üö® WebSocket error:', error);
            });
        }        // Initial connection
        connectWebSocket();

        function updateLeaderboard(leaderboard) {
            leaderboardList.innerHTML = '';
            
            leaderboard.forEach((entry, index) => {
                const li = document.createElement('li');
                li.className = 'leaderboard-item';
                
                const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : '';
                
                li.innerHTML = `
                    <span class="leaderboard-rank">${medal || (index + 1) + '.'}</span>
                    <span class="leaderboard-name">${entry.username}</span>
                    <span class="leaderboard-pumps">${entry.pumps.toLocaleString()} pumps</span>
                `;
                
                leaderboardList.appendChild(li);
            });
        }

        userCounter.textContent = userPumps.toLocaleString();
    </script>
</body>
</html>
